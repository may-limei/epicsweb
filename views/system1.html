<!DOCTYPE html>

<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->

<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->

<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->

<!-- BEGIN HEAD -->

<head>

	<meta charset="utf-8" />

	<title>TMSR | EPICS -
		<%= title %>
	</title>

	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="TMSR SF0" />
	<meta content="" name="may" />

	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
	<link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link href="media/css/style-metro.css" rel="stylesheet" type="text/css" />
	<link href="media/css/style.css" rel="stylesheet" type="text/css" />
	<link href="media/css/style-responsive.css" rel="stylesheet" type="text/css" />
	<link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color" />
	<link href="media/css/uniform.default.css" rel="stylesheet" type="text/css" />
	<link href="stylesheets/system0.css" rel="stylesheet" type="text/css" />
	<link href="stylesheets/flex.css" rel="stylesheet" type="text/css" />
	<!-- END GLOBAL MANDATORY STYLES -->

	<link rel="shortcut icon" href="media/image/favicon.ico" />

	<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
	<script src="js/angular.min.js"></script>
	<script src="socket.io/socket.io.js"></script>
	<script src="bower_components/async/dist/async.js"></script>

</head>
<!-- END HEAD -->

<!-- BEGIN BODY -->
<body class="page-header-fixed ng-scope page-sidebar-closed" ng-app="myApp" ng-controller="myCtrl" onload="load()" style="background-color:black !important;">
	<!-- BEGIN CONTAINER -->
	<div class="page-container row-fluid" style="margin-top:0;">
		<!-- BEGIN HORIZONTAL MENU PAGE SIDEBAR1 -->
		<div id="siderbox" class="page-sidebar nav-collapse collapse" style="background-color:black !important;">
			<ul class="page-sidebar-menu hidden-phone hidden-tablet">
				<li>
					<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
					<div class="sidebar-toggler hidden-phone"></div>
					<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
				</li>

				<li>
					<!-- BEGIN RESPONSIVE QUICK SEARCH FORM -->
					<form class="sidebar-search">
						<div class="input-box">
							<a href="javascript:;" class="remove"></a>
							<input type="text" placeholder="Search..." />
							<input type="button" class="submit" value=" " style="background-color:black !important;"/>
						</div>
					</form>
					<!-- END RESPONSIVE QUICK SEARCH FORM -->
				</li>

				<li>
					<a href="javascript:;">
					<i class="icon-cogs"></i> 
					<span class="title"><span>概述</span>
					<span class="selected "></span>
					<span class="arrow open"></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="/system_structure">
							 	系统结构  </a>
						</li>
						<li>
							<a href="/control_system">					
								控制系统 </a>
							<!-- <ul class="sub-menu">
									<li >
										<a href="portlet_general.html">
											信号变量</a>
									</li>
								</ul> -->
						</li>
						<li>
							<a href="/epics_manual">
								安装配置 </a>
						</li>
					</ul>
				</li>

				<li>
					<a href="javascript:;">
					<i class="icon-dashboard"></i> 
						<span class="title">监视控件</span>
						<span class="arrow "></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="/widget_tank">
								Tank</a>
						</li>
						<li >
							<a href="widget_gauge_meter">
							Gauge/Meter </a>
						</li>
						<li>
							<a href="widget_led">					
						    	LED</a>
						</li>
						<li>
							<a href="widget_tank_thermometer_bar">					
								Tank/Thermometer/Bar</a>
						</li>
						<li>
							<a href="portlet_draggable.html">
								Meter </a>
						</li>
						<li>
							<a href="portlet_draggable.html">					
						 		Guage </a>
						</li>
					</ul>
				</li>
				<li>
					<a href="javascript:;">
					<i class="icon-puzzle-piece"></i> 
					<span class="title">控制控件</span>
					<span class="arrow "></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="TextInput.html">
							TextInput </a>
						</li>
						<li>
							<a href="maps_vector.html">
							Vector Maps                   </a>
						</li>
					</ul>
				</li>
				<li>
					<a href="charts.html">
					<i class="icon-film"></i> 
					<span class="title">其它</span>
					</a>
				</li>
				<li class="active">
					<a href="javascript:;">
						<i class="icon-puzzle-piece"></i> 
						<span class="title">系统应用</span>
						<span class="arrow "></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="TextInput.html">
							智能监控                  </a>
						</li>
						<li>
							<a href="maps_vector.html">
							辐射监测                   </a>
						</li>
						<li class="active">
							<a href="system0">
							综合实验平台               </a>
						</li>
					</ul>
				</li>
				<li>
					<a href="/comment">			
						<i class="icon-comment"></i>
						<span class="title">留言板</span>
						<span class="badge" style="background-color: #e02222;padding: 2px 6px 2px 6px;-webkit-border-radius: 12px !important; -moz-border-radius: 12px !important; border-radius: 12px !important; text-shadow: none !important" >new</span>
					</a>
				</li>
			</ul>
			
			<!--HORIZONTAL AND SIDEBAR MENU FOR MOBILE & TABLETS-->
			<ul class="page-sidebar-menu visible-phone visible-tablet">
				<li class="start active">
					<a href="/">
					概述
					<span class="selected"></span>
					<span class="arrow open"></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="/system_structure">
							<i class="icon-cogs"></i> 
							<span class="title" >系统结构</span>
							<span class="arrow open"></span>
							</a>
						</li>
						<li>
							<a href="/control_system">
								<i class="icon-wrench"></i>
								<span class="title">控制系统</span>
								<span class="arrow open"></span>
							</a>
						</li>
						<li>
							<a href="/epics_manual">
								<i class="icon-wrench"></i> 
								<span class="title" >安装配置</span>
								<span class="arrow open"></span>
							</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>
		<!-- END BEGIN HORIZONTAL MENU PAGE SIDEBAR -->

		<!-- BEGIN PAGE -->
		<div id="bodybox" class="page-content row-fluid flex-h" style="background-color:black; overflow:hidden; margin:0vh 1vh; padding:0vh 0.5vh; border:0.3vh solid rgb(50,50,50);" ng-controller="holeCtrl">
			<!-- <div> -->
				<div id="echartsDIV" style="background-color:#e02222; border:0.01vh solid black; overflow:hidden;">
					<div id="titleText" style="padding:0.3vh; background-color:aliceblue;">
						<label style="text-align:center; height:6vh; line-height:6vh; overflow:hidden; font-size:3vh !important; font-weight:bold; color:rgb(170,170,170); border-bottom:0.3vh solid rgb(50,50,50); border-top:0.3vh solid rgb(50,50,50);">20kW&nbsp高温制氢试验装置</label>
					</div>
					<div id="echartsContainer1" style="background-color:aqua"></div><!--position定位不能设置为relative之外的值，因为echarts中会用到-->
					<div id="echartsContainer2" style="background-color:bisque"></div><!--position定位不能设置为relative之外的值，因为echarts中会用到-->
					<div id="tmsrImage" class="flex-h flex-hc flex-vc" style="text-align:center; height:6vh; line-height:6vh; background-color:blue;"><img src="image/sinap.png" style="height:2.8vh; margin:0 auto;" /></div>
				</div>
				<div id="screenContainer" style="background-color:green; border:0.01vh solid black; overflow:hidden;">
					123
				</div>
			<!-- </div> -->
		</div>
		<!-- END PAGE -->
	</div>
	<!-- END CONTAINER -->


<!-- start - echarts -->
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
<script type="text/javascript">
	var window_innerHeight=parseFloat(window.innerHeight);
	var window_innerWidth=parseFloat(window.innerWidth);
	var window_innerHeight=parseFloat(window.innerHeight);
	var siderbox_offsetWidth=parseFloat(document.getElementById("siderbox").offsetWidth);
	var titleText_offsetHeight=parseFloat(document.getElementById("titleText").offsetHeight);
	var tmsrImage_offsetHeight=parseFloat(document.getElementById("tmsrImage").offsetHeight);
	var bodybox_clientHeight=parseFloat(document.getElementById("bodybox").clientHeight);

	document.getElementsByTagName("html")[0].style.overflow="hidden";
	document.getElementById("bodybox").style.width=(window_innerWidth-siderbox_offsetWidth)*99.9/100+"px";//总宽度大于屏幕宽度，因为没有考虑bodybox的border和padding和margin
	document.getElementById("bodybox").style.height=window_innerHeight*98/100+"px";
	document.getElementById("echartsDIV").style.width=parseFloat(document.getElementById("bodybox").style.width)/4+"px";
	document.getElementById("screenContainer").style.width=parseFloat(document.getElementById("bodybox").style.width)/4*3+"px";

	var echartsContainer1 = document.getElementById("echartsContainer1");
	echartsContainer1.style.height=(parseFloat(document.getElementById("bodybox").style.height)-titleText_offsetHeight-tmsrImage_offsetHeight)/2+"px";
	echartsContainer1.style.marginTop=(window_innerHeight-parseFloat(echartsContainer1.offsetHeight)*2-titleText_offsetHeight-tmsrImage_offsetHeight)/12+"px";
	echartsContainer1.style.marginBottom=(window_innerHeight-parseFloat(echartsContainer1.offsetHeight)*2-titleText_offsetHeight-tmsrImage_offsetHeight)/12+"px";
	var echartsContainer2 = document.getElementById("echartsContainer2");
	echartsContainer2.style.height=(parseFloat(document.getElementById("bodybox").style.height)-titleText_offsetHeight-tmsrImage_offsetHeight)/2+"px";
	echartsContainer2.style.marginBottom=(window_innerHeight-parseFloat(echartsContainer1.offsetHeight)*2-titleText_offsetHeight-tmsrImage_offsetHeight)/12+"px";

	var myChart1 = echarts.init(echartsContainer1);
	var myChart2 = echarts.init(echartsContainer2);
	var app = {};
	option = null;
	function randomData() {
		now = new Date(+now + oneDay);
		value = value + Math.random() * 21 - 10;
		return {
			name: now.toString(),
			value: [
				[now.getFullYear(), now.getMonth() + 1, now.getDate()].join('/'),
				Math.round(value)
			]
		}
	}
	
	var data = [];
	var now = +new Date(1997, 9, 3);
	var oneDay = 24 * 3600 * 1000;
	var value = Math.random() * 1000;
	for (var i = 0; i < 1000; i++) {
		data.push(randomData());
	}
	
	option = {
		title: {
			text: '动态数据 + 时间坐标轴',
			textStyle: {
				// align: 'center',
				x: '50%',
				fontSize: 16,
				color: 'rgb(135,135,135)',
				fontWeight: 'lighter',
			}
		},
		tooltip: {
			trigger: 'axis',
			formatter: function (params) {
				params = params[0];
				var date = new Date(params.name);
				return date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear() + ' : ' + params.value[1];
			},
			axisPointer: {
				animation: false
			}
		},
		xAxis: {
			type: 'time',
			splitLine: {
				show: false
			}
		},
		yAxis: {
			type: 'value',
			boundaryGap: [0, '100%'],
			splitLine: {
				show: false
			}
		},
		series: [{
			name: '模拟数据',
			type: 'line',
			showSymbol: false,
			hoverAnimation: false,
			data: data
		}]
	};
	
	setInterval(function () {
	
		for (var i = 0; i < 5; i++) {
			data.shift();
			data.push(randomData());
		}
	
		myChart1.setOption({
			series: [{
				data: data
			}]
		});
		myChart2.setOption({
			series: [{
				data: data
			}]
		});
	}, 1000);;
	if (option && typeof option === "object") {
		myChart1.setOption(option, true);
		myChart2.setOption(option, true);
	}
</script>
<!-- start - echarts -->


	<!-- BEGIN CORE PLUGINS -->
	<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
	<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
	<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
	<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
	<script src="media/js/bootstrap.min.js" type="text/javascript"></script>
	<!-- [if lt IE 9]>
	<script src="media/js/excanvas.min.js"></script>
	<script src="media/js/respond.min.js"></script>  
	<![endif]    -->
	<script src="media/js/jquery.slimscroll.min.js" type="text/javascript"></script>
	<script src="media/js/jquery.blockui.min.js" type="text/javascript"></script>
	<script src="media/js/jquery.cookie.min.js" type="text/javascript"></script>
	<script src="media/js/jquery.uniform.min.js" type="text/javascript"></script>
	<!-- END CORE PLUGINS -->

	<script>
		//右下角时间
		// var clockT=document.getElementById("clock");
		// var y,mo,d,h,mi,s;
		// var clockInterval=setInterval(function clock(){
		// 	with(new Date) {
		// 		y=getYear()+1900;
		// 		mo=getMonth()+1;
		// 		d=getDate();
		// 		h=getHours(); h=(h<10?"0"+h:h);
		// 		mi=getMinutes(); mi=(mi<10?"0"+mi:mi);
		// 		s=getSeconds(); s=(s<10?"0"+s:s);
		// 		clockT.textContent=y+"年"+mo+"月"+d+"日  "+h+":"+mi+":"+s;
		// 	}
		// },1000);
		
		//socket模块和epics变量模块定义
		var serverIP = "10.10.33.102";
		var socket = io.connect(serverIP + ':80');
		var pvs = {
			bangs: [
				{ pvname: "may:bang1" }, { pvname: "may:bang2" }, { pvname: "may:bang3" }, { pvname: "may:bang4" }, 
				{ pvname: "may:bang5" }, { pvname: "may:bang6" }, { pvname: "may:bang7" }, { pvname: "may:bang8" }, 
				{ pvname: "may:bang9" }, { pvname: "may:bang10" }, { pvname: "may:bang11" }, { pvname: "may:bang12" }, 
				{ pvname: "may:bang13" }, { pvname: "may:bang14" }, { pvname: "may:bang15" }, { pvname: "may:bang16" }, 
				{ pvname: "may:bang17" }, { pvname: "may:bang18" }, { pvname: "may:bang19" }],
			bars:[
				{ pvname: "may:bar1"} , { pvname: "may:bar2"} , { pvname: "may:bar3"} , { pvname: "may:bar4"} , { pvname: "may:bar5"} ,
				{ pvname: "may:bar6"} , { pvname: "may:bar7"} , { pvname: "may:bar8"} , { pvname: "may:bar9"} , { pvname: "may:bar10"}]
		}

		/* start - angularJS script */
		var app = angular.module('myApp', []);
		app.controller('myCtrl', function ($scope, $http) {
			var myUrl = "http://47.100.41.42/epics_manual/manual?callback=JSON_CALLBACK";
			$http.jsonp(myUrl).success(function (response) {
				$scope.manual = response;
			});
		});
		app.controller('holeCtrl', function ($scope, $window) {
			// $scope.windowW = $window.innerWidth;
			// $scope.windowH = $window.innerHeight;

			$scope.bang=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19];
			$scope.bar=[218,170,190,230,140,254,244,180,146,192];
			async.map(pvs.bangs, function (item) {
				socket.on(item.pvname, function (data) {
					$scope.$apply(function () {	//手动出发脏检查。必须有这步才能自动通知angular的module和controller，$scope.bang发生变化了。详见腾讯课堂教程《$scope》节
						$scope.bang[parseInt(item.pvname.slice((item.pvname.indexOf(":")+5)))-1]=data.toFixed(3);
						// console.log(item.pvname+", 当前bang序号为："+parseInt(item.pvname.slice(8)));
						//由于bang的pv名称开头都是“may:bang”这8个字符，bang后面的数字是从第9个字符起，即pv名称字符串的序号为8的字符起，
						//所以，item.pvname.slice(8)获取的是当前data对应的bang序号。例如，当前pv名称为"may:bang1"，则对应bang序号为1，即item.pvname.slice(8)的值
						// console.log(item.pvname+", 当前bang序号为："+parseInt(item.pvname.slice((item.pvname.indexOf(":")+5))));//其他主机的用户名不一定是may，所以更换找数字的方式
					})
					// console.log("bang1 data is "+$scope.bang[0]);
				});
			}, function (err, results) {
				// callback(err, results);
			});
			async.map(pvs.bars, function (item) {
				socket.on(item.pvname, function (data) {
					$scope.$apply(function () {
						$scope.bar[parseInt(item.pvname.slice((item.pvname.indexOf(":")+4)))-1]=data.toFixed(0);
					})
					// console.log(item.pvname+"data is "+data);
					console.log("$scope.bar is "+$scope.bar[0]);
				});
			}, function (err, results) {
				// callback(err, results);
			});
			
		});
		/* end - angularJS script */


		

	</script>

	<script src="js/jquery.min.js"></script>

	<script>
		function load() {
			$(".manual").each(function () {
				var content = $(this).text();
				//  console.log(content);
				$(this).html(content);
			})
			// console.log("结束");	
			// window.status="Page is loaded"
		}
	</script>

	<script src="media/js/app.js"></script>
	<script>
		function jump() {
			window.open("/comment/add", '', '', true)
		}
	</script>

	<script>
		jQuery(document).ready(function () {
			// console.log("开始");
			App.init();

		});
	</script>

	<!-- END JAVASCRIPTS -->

	<script type="text/javascript">
		var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-37564768-1']); _gaq.push(['_setDomainName', 'keenthemes.com']); _gaq.push(['_setAllowLinker', true]); _gaq.push(['_trackPageview']); (function () { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();
	</script>

</body>

<!-- END BODY -->

</html>
